{{ define "main" }}

<!-- Page Header -->
<section class="hero" style="padding: var(--space-12) 0;">
  <div class="hero-grid"></div>
  <div class="container">
    <div class="hero-content" style="max-width: 900px;">
      <!-- Breadcrumb -->
      <nav style="margin-bottom: var(--space-4);">
        <ol style="display: flex; align-items: center; gap: var(--space-2); list-style: none; padding: 0; margin: 0; font-size: var(--text-sm);">
          <li><a href="{{ .Site.BaseURL }}" style="color: rgba(255,255,255,0.7);">Home</a></li>
          <li style="color: rgba(255,255,255,0.5);">/</li>
          {{ with .Parent }}
          <li><a href="{{ .Permalink }}" style="color: rgba(255,255,255,0.7);">{{ .Title }}</a></li>
          <li style="color: rgba(255,255,255,0.5);">/</li>
          {{ end }}
          <li style="color: rgba(255,255,255,0.9);">{{ .Title }}</li>
        </ol>
      </nav>
      <h1 class="hero-title" style="font-size: clamp(var(--text-2xl), 4vw, var(--text-4xl));">{{ .Title }}</h1>
      {{ if .Date }}
      <p class="hero-description" style="font-size: var(--text-base);">
        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
        {{ with .Params.author }} • by {{ . }}{{ end }}
        {{ if .ReadingTime }} • {{ .ReadingTime }} min read{{ end }}
      </p>
      {{ end }}
    </div>
  </div>
</section>

<!-- Content Section -->
<section class="section" style="padding-top: var(--space-8);">
  <div class="container">
    <div class="content-layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-inner">
          <nav class="sidebar-nav">
            {{ with .Parent }}
            <h4 class="sidebar-title">{{ .Title }}</h4>
            <ul class="sidebar-list">
              {{ range .Pages.ByWeight }}
              <li class="sidebar-list-item">
                <a href="{{ .Permalink }}" class="sidebar-link{{ if eq $.RelPermalink .RelPermalink }} active{{ end }}">
                  {{ .Title }}
                </a>
              </li>
              {{ end }}
            </ul>
            {{ else }}
            <h4 class="sidebar-title">On This Page</h4>
            <ul class="sidebar-list" id="tocList">
              <!-- Table of contents will be generated by JS -->
            </ul>
            {{ end }}
          </nav>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="main-content">
        <article class="article-content">
          {{ .Content }}
        </article>

        <!-- Article Footer -->
        <footer style="margin-top: var(--space-12); padding-top: var(--space-6); border-top: 1px solid var(--border-primary);">
          <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: var(--space-4);">
            <p style="font-size: var(--text-sm); color: var(--text-tertiary); margin: 0;">
              Last updated: {{ .Lastmod.Format "January 2, 2006" }}
            </p>
            {{ with .File }}
            <a href="https://github.com/dsccommunity/dsccommunity.org/edit/master/content/{{ .Path }}"
               class="btn btn-ghost btn-sm"
               target="_blank"
               rel="noopener noreferrer">
              <i class="ri-edit-line"></i>
              Edit this page
            </a>
            {{ end }}
          </div>
        </footer>

        <!-- Pagination -->
        <nav style="display: flex; justify-content: space-between; margin-top: var(--space-8); gap: var(--space-4);">
          {{ with .PrevInSection }}
          <a href="{{ .Permalink }}" class="card" style="flex: 1; max-width: 45%; text-decoration: none;">
            <div style="display: flex; align-items: center; gap: var(--space-2); font-size: var(--text-sm); color: var(--text-tertiary); margin-bottom: var(--space-2);">
              <i class="ri-arrow-left-line"></i>
              Previous
            </div>
            <span class="card-title" style="font-size: var(--text-base);">{{ .Title }}</span>
          </a>
          {{ else }}
          <div style="flex: 1;"></div>
          {{ end }}

          {{ with .NextInSection }}
          <a href="{{ .Permalink }}" class="card" style="flex: 1; max-width: 45%; text-align: right; text-decoration: none;">
            <div style="display: flex; align-items: center; justify-content: flex-end; gap: var(--space-2); font-size: var(--text-sm); color: var(--text-tertiary); margin-bottom: var(--space-2);">
              Next
              <i class="ri-arrow-right-line"></i>
            </div>
            <span class="card-title" style="font-size: var(--text-base);">{{ .Title }}</span>
          </a>
          {{ end }}
        </nav>
      </div>
    </div>
  </div>
</section>

<!-- TOC Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const article = document.querySelector('.article-content');
  const tocList = document.getElementById('tocList');

  if (article && tocList && !tocList.children.length) {
    const headings = article.querySelectorAll('h2, h3');

    if (headings.length > 0) {
      headings.forEach((heading, index) => {
        if (!heading.id) {
          heading.id = 'heading-' + index;
        }

        const li = document.createElement('li');
        li.className = 'sidebar-list-item';

        const a = document.createElement('a');
        a.href = '#' + heading.id;
        a.className = 'sidebar-link';
        a.textContent = heading.textContent;

        if (heading.tagName === 'H3') {
          a.style.paddingLeft = 'var(--space-6)';
          a.style.fontSize = 'var(--text-xs)';
        }

        li.appendChild(a);
        tocList.appendChild(li);
      });
    }
  }
});
</script>

{{ end }}
